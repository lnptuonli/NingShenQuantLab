# ✅ 量化调度平台开发待办清单

> **快速参考**：本清单按照开发顺序列出所有待办事项，完成一项勾选一项

---

## 📋 阶段一：基础设施搭建（预计1-2天）

### 1. 目录结构创建
- [ ] 创建 `quant` 包及子包
  ```bash
  src/main/java/com/ningshenquantlab/alphaforge_demo1/
  ├── quant/
  │   ├── controller/
  │   ├── service/
  │   ├── entity/
  │   ├── dto/
  │   └── dao/
  ├── executor/
  ├── async/
  ├── monitor/
  ├── config/
  └── common/enums/
  ```

### 2. 数据库表创建
- [ ] 在数据库中执行 `task_record` 表创建 SQL
- [ ] 在数据库中执行 `task_log` 表创建 SQL
- [ ] （可选）创建 `feature_calc_record` 表
- [ ] 验证表创建成功

### 3. 配置文件扩展
- [ ] 在 `application.yml` 中添加 Python 配置块
- [ ] 配置 Python 解释器路径（根据您的实际环境）
- [ ] 配置脚本根目录路径
- [ ] 添加异步任务配置
- [ ] 添加任务监控配置

### 4. 公共类和枚举
- [ ] 创建 `TaskStatusEnum.java`（PENDING, RUNNING, SUCCESS, FAILED, CANCELLED）
- [ ] 创建 `TaskTypeEnum.java`（FEATURE_CALC, DATA_FETCH, MODEL_TRAIN）
- [ ] 创建 `ExecutionResult.java`（执行结果封装类）

### 5. 实体类创建
- [ ] 创建 `TaskRecord.java`（任务记录实体）
- [ ] 创建 `TaskLog.java`（任务日志实体）
- [ ] 添加 Lombok 注解（@Data, @Builder, @NoArgsConstructor, @AllArgsConstructor）

---

## 📋 阶段二：Python 执行引擎（预计2-3天）

### 6. 执行器接口和实现
- [ ] 创建 `PythonExecutor.java` 接口
  - [ ] 定义 `executeSync` 方法
  - [ ] 定义 `executeAsync` 方法
  - [ ] 定义 `cancelTask` 方法
  - [ ] 定义 `getTaskStatus` 方法

- [ ] 创建 `LocalPythonExecutor.java` 实现类
  - [ ] 实现同步执行逻辑（ProcessBuilder）
  - [ ] 实现输出流捕获
  - [ ] 实现错误处理

### 7. 辅助工具类
- [ ] 创建 `CommandBuilder.java`
  - [ ] 实现 `buildFeatureCalcCommand` 方法
  - [ ] 支持参数拼接（start, end, force）
  
- [ ] 创建 `ProcessManager.java`
  - [ ] 实现进程启动
  - [ ] 实现进程监控
  - [ ] 实现进程终止

- [ ] 创建 `OutputCollector.java`
  - [ ] 实现实时输出捕获
  - [ ] 实现日志保存

### 8. 异步任务配置
- [ ] 创建 `AsyncConfig.java`
  - [ ] 配置线程池（核心线程数、最大线程数、队列容量）
  - [ ] 添加 `@EnableAsync` 注解
  
- [ ] 创建 `AsyncTaskExecutor.java`
  - [ ] 实现异步任务执行
  - [ ] 使用 `CompletableFuture`

### 9. 单元测试（执行引擎）
- [ ] 编写简单 Python 脚本（例如：hello.py）
- [ ] 测试同步执行
- [ ] 测试异步执行
- [ ] 测试参数传递
- [ ] 测试日志捕获
- [ ] 测试超时处理
- [ ] 测试错误处理

---

## 📋 阶段三：特征计算模块（预计3-4天）

### 10. DTO 设计
- [ ] 创建 `FeatureCalcRequest.java`
  ```java
  // 字段：startDate, endDate, force, async
  ```
- [ ] 创建 `TaskQueryRequest.java`
  ```java
  // 字段：page, size, status, taskType, startDate, endDate
  ```
- [ ] 创建 `TaskResponse.java`
  ```java
  // 字段：taskId, taskName, status, createTime, logs...
  ```
- [ ] 添加校验注解（@NotNull, @Pattern）

### 11. DAO 层开发
- [ ] 创建 `TaskRecordDao.java` 接口
  - [ ] 定义 insert 方法
  - [ ] 定义 update 方法
  - [ ] 定义 findById 方法
  - [ ] 定义 findByPage 方法
  
- [ ] 创建 `TaskRecordDaoImpl.java`（使用 JdbcTemplate）
  - [ ] 实现所有接口方法
  
- [ ] 创建 `TaskLogDao.java` 接口
  - [ ] 定义 insertBatch 方法
  - [ ] 定义 findByTaskId 方法
  
- [ ] 创建 `TaskLogDaoImpl.java`
  - [ ] 实现所有接口方法

### 12. Service 层开发
- [ ] 创建 `FeatureService.java` 接口
  - [ ] 定义 calculateFeatures 方法
  - [ ] 定义 getTaskStatus 方法
  - [ ] 定义 getTaskLogs 方法
  - [ ] 定义 cancelTask 方法
  
- [ ] 创建 `FeatureServiceImpl.java` 实现类
  - [ ] 实现任务创建逻辑
  - [ ] 调用 CommandBuilder 构建命令
  - [ ] 调用 PythonExecutor 执行脚本
  - [ ] 保存任务记录到数据库
  - [ ] 保存日志到数据库
  - [ ] 更新任务状态
  - [ ] 添加 @Transactional 事务管理

### 13. Controller 层开发
- [ ] 创建 `FeatureController.java`
  - [ ] `POST /api/v1/features/calculate` - 提交特征计算任务
  - [ ] `GET /api/v1/features/tasks` - 查询任务列表
  - [ ] `GET /api/v1/features/tasks/{taskId}` - 查询任务详情
  - [ ] `GET /api/v1/features/tasks/{taskId}/logs` - 获取任务日志
  - [ ] `POST /api/v1/features/tasks/{taskId}/cancel` - 取消任务
  - [ ] `POST /api/v1/features/tasks/{taskId}/retry` - 重试任务
  - [ ] 添加参数校验 @Validated
  - [ ] 添加异常处理

### 14. 集成测试（特征计算）
- [ ] 使用 Postman/IDEA HTTP Client 测试
- [ ] 测试提交任务（同步）
- [ ] 测试提交任务（异步）
- [ ] 测试查询任务状态
- [ ] 测试获取任务日志
- [ ] 测试取消任务
- [ ] 测试强制重算参数（--force）
- [ ] 测试日期参数校验
- [ ] 测试错误场景（脚本不存在、参数错误）

---

## 📋 阶段四：监控和管理（预计1-2天）

### 15. 任务监控
- [ ] 创建 `TaskMonitor.java`
  - [ ] 实现定时检查任务状态（@Scheduled）
  - [ ] 实现超时任务处理
  - [ ] 实现僵尸进程清理
  
- [ ] （可选）创建 `ResourceMonitor.java`
  - [ ] 监控 CPU 使用率
  - [ ] 监控内存使用率
  - [ ] 记录监控数据

### 16. 通用任务管理
- [ ] 创建 `TaskController.java`
  - [ ] `GET /api/v1/tasks` - 查询所有任务（分页、过滤）
  - [ ] `GET /api/v1/tasks/{taskId}` - 查询任务详情
  - [ ] `DELETE /api/v1/tasks/{taskId}` - 删除任务记录
  - [ ] `GET /api/v1/tasks/statistics` - 任务统计（成功率、平均耗时）
  
- [ ] 创建 `TaskService.java` 和实现类
  - [ ] 实现任务查询逻辑
  - [ ] 实现任务删除逻辑
  - [ ] 实现统计逻辑

---

## 📋 阶段五：扩展模块（按需开发）

### 17. 数据获取模块
- [ ] 创建 `DataController.java`
- [ ] 创建 `DataService.java`
- [ ] 创建相关 DTO
- [ ] 实现数据获取任务调度（参照特征计算）

### 18. 模型训练模块
- [ ] 创建 `ModelController.java`
- [ ] 创建 `ModelService.java`
- [ ] 创建相关 DTO
- [ ] 实现模型训练任务调度
- [ ] 实现训练指标记录

---

## 📋 阶段六：优化和完善（持续）

### 19. 性能优化
- [ ] 优化数据库连接池配置
- [ ] 优化异步任务队列大小
- [ ] 实现日志文件存储（避免数据库过大）
- [ ] 添加缓存（Redis，可选）

### 20. 文档完善
- [ ] 生成 Swagger API 文档
- [ ] 编写部署文档
- [ ] 编写运维手册
- [ ] 编写 Python 脚本开发规范

### 21. 监控告警
- [ ] 实现任务失败邮件通知
- [ ] 实现任务失败钉钉通知
- [ ] 实现资源占用告警

---

## 📋 测试和部署

### 22. 完整测试
- [ ] 单元测试覆盖率 > 70%
- [ ] 集成测试（完整流程）
- [ ] 压力测试（并发任务）
- [ ] 异常场景测试

### 23. 部署准备
- [ ] 准备生产环境配置文件
- [ ] 准备启动脚本
- [ ] 准备数据库初始化脚本
- [ ] 编写部署文档

---

## 🎯 里程碑

- ✅ **里程碑 1**：完成阶段一 + 阶段二（基础设施 + 执行引擎）
- ⏳ **里程碑 2**：完成阶段三（特征计算模块可用）← **当前目标**
- ⏳ **里程碑 3**：完成阶段四（监控和管理）
- ⏳ **里程碑 4**：完成阶段五（所有模块）

---

## 📞 遇到问题怎么办？

1. **配置问题**：检查 application.yml 中的路径是否正确
2. **Python 执行失败**：先在命令行手动测试 Python 脚本
3. **日志看不到**：检查 OutputCollector 是否正确捕获输出
4. **任务状态不更新**：检查数据库连接、事务配置
5. **参考文档**：查看《量化调度平台架构设计与实施指南.md》

---

## 🚀 开始行动

**建议从阶段一的第一个任务开始：**
1. 创建目录结构
2. 创建数据库表
3. 配置 application.yml

**祝开发顺利！💪**

---

*清单生成时间：2025-12-29*  
*版本：V1.0*

